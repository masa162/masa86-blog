PRAGMA defer_foreign_keys=TRUE;
CREATE TABLE posts (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  slug TEXT NOT NULL UNIQUE,
  title TEXT NOT NULL,
  content TEXT NOT NULL,
  tags TEXT DEFAULT '[]',
  created_at TEXT NOT NULL,
  updated_at TEXT NOT NULL
);
INSERT INTO "posts" VALUES(1,'0001','テスト',replace('test\nテスト\nテスト01。','\n',char(10)),'[]','2025-10-31T11:27:32.440Z','2025-11-04 00:25:51');
INSERT INTO "posts" VALUES(2,'0002','はじめまして - masa86ブログ開始',replace('# はじめまして\n\nこのブログでは、技術的な学びや日々の開発で得た知識を記録していきます。\n\n## このブログについて\n\n- Next.js 16\n- Cloudflare Pages\n- D1 Database\n\nで構築しています。\n\nよろしくお願いします！','\n',char(10)),'["お知らせ", "技術"]','2025-11-02 06:50:02','2025-11-02 06:50:02');
INSERT INTO "posts" VALUES(3,'0003','Cloudflare Pagesでブログを構築した話',replace('# Cloudflare Pagesでブログを構築\n\n## 技術スタック\n\n- **Next.js 16**: 最新のReactフレームワーク\n- **OpenNext**: Cloudflare Workers対応アダプター\n- **D1 Database**: Cloudflareのエッジデータベース\n- **TypeScript**: 型安全な開発\n\n## なぜCloudflare Pages?\n\n1. 高速なエッジネットワーク\n2. 無料枠が充実\n3. D1との統合が簡単\n\n## まとめ\n\nCloudflare Pagesは素晴らしいプラットフォームです！','\n',char(10)),'["Cloudflare", "Next.js", "技術"]','2025-11-02 06:50:02','2025-11-02 06:50:02');
INSERT INTO "posts" VALUES(4,'01','源氏物語test',replace('\n# ⚓️ 史上最大の**左遷（サセン）**！源氏様、流刑先で海女と恋に落ちる🌊 〜 *「都恋しいけど、この子もカワイイ」* の葛藤\n\n✨ 平安の貴公子、光源氏がついに**キャリア最大の危機**に直面！政治的なゴタゴタで、都を追われ**辺境の地**へ。絶望の流刑生活の先に待っていたのは、**謎の老人**と、彼の**秘蔵っ子**でした。超セレブの**ドン底生活**と、それをチャンスに変えた**明石の君のサクセスストーリー**を解説！✨\n\n---\n\n## 1. 権力争いに巻き込まれ、都を追われる！😭\n\nあの光源氏が、なぜ左遷（サセン）されたのか？\n\n### 💥 「藤壺の子」問題が爆発！\n\n源氏が犯した**最大の禁忌（タブー）**、義理の母・藤壺の宮との間にできた秘密の子ども（冷泉帝）の存在が、いよいよ政治問題に発展します。\n\n*   **右大臣・弘徽殿大后サイド**：*「チャンス到来！あいつを葬れ！」* 👻\n*   **事の運び**：彼の後見人だった**桐壺帝**（父）が亡くなり、後ろ盾を失う。\n*   **結果**：**須磨（すま）**という辺境の地への**「謹慎」**という名の**左遷（サセン）**が決定。\n\n> 👑 **源氏の悲痛な叫び**：「世を思ひ知りて、**いかにして身を全うせむ**」\n> *（…もう無理ゲー！どうしたらこの身を守れるの！？）* 😭😭😭\n\n### ⛵️ 源氏の須磨での「プチ・サバイバル」生活\n\n源氏の生活レベルは、**一気にダウン**！\n\n1.  **住居**：自分で手配した**ボロい家**（都の豪邸とは大違い！）🏡\n2.  **ファッション**：**地味な服**で隠居生活（オシャレできないのが一番辛い）👔\n3.  **メンタル**：都を恋しがり、**ひたすら海を眺めて**ポエムを作る 🌊\n\n> 💡 **ポイント**：この**「左遷」**こそが、源氏を一時的に政治から遠ざけ、後の**大逆転劇**（復権）につながるのです！人生、**塞翁が馬**！\n\n## 2. 突然の嵐と「明石入道」の登場 ⛈️\n\n源氏が須磨で**鬱々**とした日々を送る中、運命の出会いが近づきます。\n\n### 🌪️ 須磨を襲った「大嵐」\n\n天変地異が発生！源氏の住まいに**落雷**が落ち、都では**「源氏の呪いか！」**と大騒ぎに。\n\n> 😱 **源氏（心の声）**：「これ、**死ぬやつ**じゃん…」\n> *（…マジでヤバい！俺は呪われてるのか！？）*\n\n### 👴 明石入道：**娘を源氏に献上**すべく暗躍！\n\n嵐が去った後、**明石（あかし）**という隣の土地に住む謎の老人、**明石入道**（あかしのにゅうどう）が源氏を訪ねてきます。\n\n*   **入道の野望**：彼は、**最高の教育**を施した一人娘（明石の君）を、**「未来の超VIP」**である源氏に嫁がせ、一族の地位を向上させること！\n*   **入道のテクニック**：**「私、人を見る目があるんです。源氏様は絶対に復権する！」**と熱く語り、娘の素晴らしさをアピール！\n\n> 🎁 **入道（心の声）**：*「娘は最高の**投資案件**じゃ…フフフ」* ← **平安時代のカリスマ・プロデューサー**！\n\n## 3. 明石の君：**「玉の輿」**を狙う才女の覚悟 👑\n\nそして、いよいよ明石の君との出会い。彼女は、**ただの地方出身の美女**ではありません！\n\n### 💃 最高の教育と「自信」\n\n*   **入道による英才教育**：幼い頃から、最高の**琴（こと）**と**書**を叩き込まれています。\n*   **環境**：都から離れた明石の地で、**孤独に耐え**、その**チャンスを虎視眈々**と待っていました。\n\n### 💘 源氏、明石の君の**「才能」**に惹かれる\n\n源氏が明石を訪れ、二人は出会います。源氏が惹かれたのは、彼女の**美貌**だけでなく、**教養の高さ**と**上品さ**でした。\n\n```markdown\n> いと奥ゆかしく、さすがに田舎めいたる所もなく、琴の音も清らに響きて、**心にくき**ものから、**いとほし**くおぼす。\n```\n\n*（彼女は**奥ゆかしく**て、**田舎っぽさゼロ**！琴の音も素晴らしく、惹かれるけど、どこか**高嶺の花感**もあって、源氏は**もどかしく**思う。）*\n\n### ⚠️ 明石の君の**プライド**！\n\n源氏からのアプローチに対し、明石の君は**すぐにはなびきません！**\n\n*   **彼女の言い分**：「私は地方の人間です。源氏様の**数多の愛人**の一人にはなりたくない！」\n*   **入道の策略**：源氏が**本気**になるまで、**焦らし戦術**を実行！\n\n> **🔥 結果**：明石の君の**「待てる女」**戦略が功を奏し、源氏が**本気で愛する**に至ります。彼女のプライドと戦略こそが、後に彼女の娘（明石の姫君）が**皇室に入る**という偉業を達成する土台となったのです！\n\n---\n\n## 4. 奇跡の復権と、明石からの卒業 🎓\n\nしばらくして、都では源氏を追いやった政敵たちが次々と没落！**源氏復権のチャンス**が訪れます！\n\n*   **復権！**：源氏は**名誉回復**を果たし、ついに**都へ凱旋**！🎉\n*   **明石の君は？**：彼女は妊娠していたため、都へは**連れて行けず**、明石に残ることに…。\n\n> 💔 **明石の君（心の声）**：「やっと源氏様と一緒になれたのに…また**遠距離恋愛**…」\n> *（…まあ、私は子どもさえ産めば**勝てる**から！）* ← **計算高い才女**！\n\n### **【予告】明石の君の娘**\n\n明石の君は、都で娘を出産。その子はなんと、後に**皇太子**の母となり、**超VIP**となります。\n\n> 💡 **まとめ**：須磨・明石編は、源氏の**人生のドン底**と、**明石の君という一発逆転を狙う女性**との出会い。そして、彼女の**戦略的ロマンス**が、源氏物語全体の**キーパーソン**を生み出す重要なエピソードなのです！\n\n---\n\n*次回は、真夏の夜のミステリー！👻 『夕顔』編でお会いしましょう！* 💖🙏','\n',char(10)),'["源氏物語"]','2025-11-02 12:32:24','2025-11-02 12:32:24');
INSERT INTO "posts" VALUES(5,'0004','test',replace('Next.jsでのブログ開発を検討されているとのこと、OpenNextは非常に注目されている技術の一つですので、詳しくご説明します。\n\n---\n\n### OpenNext（オープンネクスト）とは\n\nOpenNextは、**Next.jsアプリケーションをVercel以外のクラウド環境（特にサーバーレス）にデプロイするために利用されるオープンソースソフトウェア（OSS）**です。\n\n一言でいうと、「**どこでもNext.jsを動かせるようにする仲介ツール**」だとイメージすると分かりやすいです。\n\n#### OpenNextの役割\n\n1.  **ビルド出力の変換:** Next.jsの公式ビルド出力を解析します。\n2.  **プラットフォームへの適応:** その出力結果を、AWS（Lambda）、Cloudflare Workers、Netlifyなどの各クラウド環境に合わせて「動作する形式」に変換（アダプト）します。\n\n元々Next.jsは、公式ホスティングであるVercelで最も最適化されて動作するように設計されていますが、OpenNextはこのVercel内部の仕組みに相当するものをOSSとして提供することで、**ユーザーが自由なインフラを選べる**ようにしました。\n\n#### OpenNextの主な特徴とメリット\n\n| 特徴 | 詳細 |\n| :--- | :--- |\n| **デプロイ先の自由度** | AWS、Cloudflare Workers、Netlifyなど、Vercel以外のさまざまなプラットフォームにNext.jsアプリをデプロイできます。 |\n| **Next.js機能のフルサポート** | App Router、Pages Router、SSR（サーバーサイドレンダリング）、ISR（インクリメンタル静的再生成）、SSG（静的サイト生成）、Server Actionsなど、ほとんどの主要なNext.js機能をサポートすることを目指しています。 |\n| **コスト削減の可能性** | Vercelの従量課金やプランに依存せず、AWSやCloudflareなどの安価なサーバーレス環境や無料枠を積極的に活用できるため、特に個人開発やブログ運営においてインフラコストを抑えられる可能性があります。 |\n| **コールドスタートの改善** | AWS Lambda環境などでNext.jsを動かす際の課題であったコールドスタート（初回アクセス時の遅延）を最小限に抑えるように設計されています。 |\n\n### ブログ開発におけるOpenNextの関連性\n\nNext.jsでブログを開発する場合、一般的に以下の機能が重要になりますが、OpenNextはこれらをVercel以外の環境で実現するのに役立ちます。\n\n| ブログで重要な機能 | OpenNextで実現できること |\n| :--- | :--- |\n| **SSRやISR** | 記事のインデックスや動的なページにSSRやISRを使用し、高速な初期ロードとSEOに優れたページを実現できます。OpenNextはこれらの機能をAWS LambdaやCloudflare Workersでも動作可能にします。 |\n| **APIルート** | コメント機能やフォーム送信などのためにAPIルートを使用する場合、これもサーバーレス関数として動作します。 |\n| **低コスト運用** | ブログはアクセス数が急増する可能性もありますが、「Vercelの無料枠を超えたときの料金が気になる」といった場合に、OpenNextと低コストなクラウドサービスを組み合わせることで、高速性と低コストを両立できる構成が可能です。\n\n### まとめ\n\nNext.jsでのブログ開発で**「Vercel以外のインフラで動かしたい」「インフラコストを最適化したい」「特定のクラウドサービスのエッジ機能を使いたい」**とお考えであれば、OpenNextは非常に強力な選択肢となります。\n\n***\n\n\n**Validating the Frustration**\n\nI''m starting by acknowledging the user''s understandable frustration with the 500 errors. It''s a tough situation, common, but tricky to pinpoint. Empathy is key here. I''m focusing on validating their experience and recognizing the complexity of the issue.\n\n\n**Shifting to Solutions**\n\nI''m now shifting gears, focusing on possible solutions since acknowledging the frustration. I''m recalling how Cloudflare''s inherent support for Next.js, often leverages tech akin to OpenNext. Those 500 errors usually indicate runtime or build problems. I''m exploring how OpenNext could offer stability and what a potential solution path looks like for this user.\n\n\n**Analyzing the Instability**\n\nI''m digging deeper into the root cause of the Cloudflare Pages instability and 500 errors. Understanding the Cloudflare Workers environment limitations and adapter complexity is crucial. My focus is now on articulating how these factors specifically contribute to the user''s issue with their Next.js application. I''m building a concise diagnosis to offer a clear path to resolution, focusing on the core problem. I see the importance of explaining how those limits translate to runtime and build problems.\n\n\n**Pivoting to Stability**\n\nI''m now focusing on a stable solution, recognizing Cloudflare''s inherent challenges. My current thinking centers on AWS via SST and OpenNext as a powerful and reliable target for Next.js, as a robust alternative. I''m building a solution that helps the user avoid similar 500 errors.\n\n\n***\n\nCloudflare環境での挫折を経験された上で、Next.js以外の「次点の候補」として、Remix、Hono、Drizzleといった技術に興味を持たれているのですね。\n\nこれらはそれぞれ異なる役割を持つ技術ですが、Next.jsやブログ開発という文脈で非常に関連が深く、Next.jsの代替や、Next.jsと組み合わせて利用できる強力な選択肢になります。\n\nそれぞれの技術について、Next.jsとの関連性やブログ開発における使いどころを解説します。\n\n---\n\n### 1. Remix (リミックス)\n\n#### 概要\n\nRemixは、Next.jsと同様に**フルスタックのWebフレームワーク**です。Webの標準機能（特にWeb Fetch APIやHTTPキャッシュ）を重視し、パフォーマンスと開発者体験の向上を目指しています。\n\n#### Next.jsとの違いとブログ開発での特徴\n\n| 特徴 | Next.js (特にApp Router) | Remix |\n| :--- | :--- | :--- |\n| **データ取得** | `fetch`をコンポーネント内で使用。Server Componentでのデータ取得が主流。 | ルーティングファイルごとに用意された`loader`関数でデータを取得する（Web標準のAPIに近い設計）。 |\n| **フォーム送信** | Server ActionsやAPI Routeを使用。 | `action`関数を使用。Web標準の`<form action="post">`に基づいており、JS無効時も動く設計。 |\n| **環境適応** | Vercel最適化。アダプタ（OpenNextなど）が必要。 | **アダプタによって多様な環境に対応**（Cloudflare Workers, Express, AWS Lambdaなど）しやすく設計されている。 |\n| **開発哲学** | ファイルシステムベースのルーティングは同様だが、React中心。 | **Web標準、特にHTTP標準とネイティブなフォーム機能**を重視。 |\n\n**ブログ開発での使いどころ:**\n*   Next.jsの新しい「Server Component」や「Server Actions」のパラダイムよりも、**Web標準**に基づいた、シンプルで分かりやすいデータ取得とフォーム処理を好む場合に最適です。\n*   Cloudflare Pages/WorkersへのデプロイがNext.jsよりも**安定しやすい**実績があります。\n\n---\n\n### 2. Hono (ホノ)\n\n#### 概要\n\nHonoは、**エッジ環境（Cloudflare Workers, Vercel Edge, Denoなど）での動作に特化した、超軽量で高速なWebフレームワーク**です。\n\n「小さな、速い、エッジ向けのWebフレームワーク」という位置づけで、Next.jsやRemixのようなフルスタックというよりは、**API層**や**バックエンドのファンクション**を構築するために使われます。\n\n#### Next.jsとの違いとブログ開発での特徴\n\n| 特徴 | Next.js | Hono |\n| :--- | :--- | :--- |\n| **役割** | フルスタックフレームワーク (フロントエンド + バックエンド) | **API/バックエンド** フレームワーク |\n| **パフォーマンス** | 高速だが、ランタイムはフルスタックフレームワークのオーバーヘッドがある。 | **極めて高速、軽量**。エッジでのパフォーマンスを最優先。 |\n| **主な用途** | Webサイト全体、API、動的ページの構築。 | **ブログのバックエンドAPI、認証処理、シンプルなプロキシ機能**など。 |\n| **環境** | Vercel最適化。 | **エッジ環境**（Workers, Lambdaなど）に最適化。 |\n\n**ブログ開発での使いどころ:**\n*   ブログの**API部分**（例: コメント投稿API、人気記事ランキングAPIなど）を、Next.jsのAPI Routeよりも**軽量かつ高速なエッジ**で動かしたい場合に、Next.jsの代わりにHonoを使ってAPI層を構築できます。\n*   HonoはJSXもサポートしているため、**Honoで非常に小さな動的なWebページ全体**を作ることも可能です（Hono + htmxやReactなど）。\n\n---\n\n### 3. Drizzle ORM (ドリズル ORM)\n\n#### 概要\n\nDrizzle ORMは、JavaScript/TypeScript向けの**ORM (Object-Relational Mapper)**です。データベースの操作を、SQL文ではなくTypeScriptのコードで安全に行うためのツールです。\n\n#### Next.js/Remix/Honoとの関係とブログ開発での特徴\n\nDrizzleは**フレームワークそのものではありません**。Next.jsやRemix、Honoの**バックエンド/API層でデータベースを操作する**ために利用されます。\n\n*   **Next.jsの場合:** Server ComponentやAPI Route内でDrizzleを使ってデータベース（PostgreSQL, MySQL, SQLiteなど）に接続し、記事データの取得や保存を行います。\n*   **Remixの場合:** `loader`関数や`action`関数内でDrizzleを使ってデータベースを操作します。\n*   **Honoの場合:** Honoで構築したAPIのエンドポイントでDrizzleを使ってデータベースを操作します。\n\n**ブログ開発での使いどころ:**\n*   記事データ、ユーザー情報、コメントデータなど、**ブログのすべてのデータを安全に扱う**ために使います。\n*   **型安全:** TypeScriptと非常に相性が良く、データベースのスキーマ変更がコードに反映されるため、実行前にエラーを発見しやすく、バグを減らせます。\n*   **モダンな設計:** 軽量で、Node.jsだけでなくエッジ環境でも動作するように設計されており、Next.jsやRemixのモダンな開発スタイルにフィットします。\n\n### まとめ\n\nCloudflare環境の安定性を重視し、Next.jsに代わるものを探しているなら：\n\n*   **フルスタックな代替**を選ぶなら $\rightarrow$ **Remix**\n*   **軽量なAPI/バックエンド**をエッジで構築するなら $\rightarrow$ **Hono**\n*   **どのフレームワークを使うにしても**、データベース操作を安全に行いたいなら $\rightarrow$ **Drizzle ORM**\n\nこの中では、Next.jsと最も役割が近いのは**Remix**です。もしNext.jsのApp Routerのデータ取得の方法に複雑さを感じていたなら、Remixのシンプルな`loader`/`action`の仕組みは非常に魅力的に映るかもしれません。','\n',char(10)),'["夏休み"]','2025-11-02 23:28:55','2025-11-02 23:28:55');
INSERT INTO "posts" VALUES(6,'0005','平家物語','平家物語テスト','[]','2025-11-03 11:35:58','2025-11-03 11:35:58');
DELETE FROM sqlite_sequence;
INSERT INTO "sqlite_sequence" VALUES('posts',6);
CREATE INDEX idx_posts_created_at ON posts(created_at DESC);
CREATE INDEX idx_posts_slug ON posts(slug);
CREATE TRIGGER update_posts_updated_at
AFTER UPDATE ON posts
FOR EACH ROW
BEGIN
  UPDATE posts SET updated_at = datetime('now') WHERE id = NEW.id;
END;
